# Project Overview

This repository implements a fullâ€‘stack solution for monitoring BLE sensors, decoding their telemetry, and exposing the data through an MQTT broker.  
The stack is split into three main layers:

1. **BLE Daemon (`ble-daemon/`)**  
   - Runs as a system service that scans for BLE devices, connects to them, and forwards raw packets to the transcoder via a Unix socket.  
   - Implements reconnection logic, device filtering, and optional filtering by sensor ID.

2. **Transcoder (`transcoder/`)**  
   - Receives raw BLE payloads, decodes the proprietary format (currently defined in `transcoder/utils/decoding.py`), and publishes the structured data to the MQTT broker.  
   - Includes unit utilities for encoding/decoding and graceful shutdown handling.

3. **Gateway & API (`gateway/` + `api/`)**  
   - The gateway aggregates MQTT messages, enriches them with static configuration, and exposes a RESTful API that the frontend consumes.  
   - `gateway/` contains sensor and tag abstractions that map decoded telemetry to friendly JSON payloads.  
   - `api/` is a lightweight FastAPI service that serves the frontend and provides optional websocket endpoints for realâ€‘time updates.

4. **Frontend (`frontend/`)**  
   - Angular application that visualises sensor data, displays roaming states, and allows configuration of tags.  
   - The frontend is served by the FastAPI backend and can be built into a Docker image for deployment.

---

## Core Features

| Feature | Description |
|---------|-------------|
| **BLE Scanning & Connection** | Continuous lowâ€‘power scan, reconnection on loss, optional device whitelist. |
| **Data Decoding** | Custom binary format â†’ JSON. Extensible via `transcoder/utils/encoding.py`. |
| **MQTT Bridge** | Publish decoded telemetry to `sensor/{uuid}` topics. |
| **REST API** | CRUD for tags, sensor configuration, and live telemetry streams. |
| **Frontend Dashboard** | Realâ€‘time charts, roaming state map, tag management UI. |
| **Deployment** | Dockerâ€‘compose configuration for local dev (`docker-compose.yml`) and production (`docker-compose.prod.yml`). |

---

## Getting Started

```bash
# Clone repo
git clone https://github.com/yourorg/ble-monitoring.git
cd ble-monitoring

# Create virtual environment for Python services
python3 -m venv .venv
source .venv/bin/activate

# Install dependencies
pip install -r transcoder/requirements.txt
pip install -r ble-daemon/requirements.txt
pip install -r api/requirements.txt

# Start services
docker compose up
```

The `docker compose` command will start the BLE daemon, transcoder, MQTT broker, gateway, and frontend in separate containers.

---

## Architecture Diagram

```
+-----------------+      +-------------------+      +--------------------+
| BLE Sensors     | ---> | BLE Daemon (scan) | ---> | Transcoder (decode)|
+-----------------+      +-------------------+      +--------------------+
                                                               |
                                                               v
                                                    +--------------------+
                                                    | MQTT Broker        |
                                                    +--------------------+
                                                               |
                                                               v
                                                    +--------------------+
                                                    | Gateway API        |
                                                    +--------------------+
                                                               |
                                                               v
                                                    +--------------------+
                                                    | Frontend (Angular) |
                                                    +--------------------+
```

---

## Extending the System

- **Adding a new sensor type** â€“ Update the decoder in `transcoder/utils/decoding.py` and add corresponding tag/sensor classes under `gateway/`.  
- **Custom MQTT topics** â€“ Modify `gateway/config.py` or add new entries in `gateway/tag/tag.py`.  
- **Deployment tweaks** â€“ Update `deployments/docker-compose.yml` or `deployments/docker-compose.prod.yml` to add environment variables or new services.

---

For detailed usage of each component, see the following sections:

- [Infrastructure Setup](infrastructure.md)  
- [Roaming States & Tag Management](roaming_states.md)  
- [Use Cases & Testing](use_cases_and_testing.md)  
- [API Reference](api/api.py) â€“ (autogenerated by FastAPI)

Happy hacking! ðŸŽ‰



